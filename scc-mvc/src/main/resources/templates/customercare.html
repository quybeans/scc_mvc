<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <title>Social Customer Care</title>
    <header class="main-header" th:include="Head::header"></header>
    <aside class="main-sidebar" th:include="SideBar::aside"></aside>

    <script th:src="@{/js/jquery_dateFormat.js}"></script>
    <script>
        //Reply to comment
        function replyToComment(objId) {


            $('#myModal').modal('toggle');

            $('#btnReply').unbind().click(function () {
                if ($('#txtReply').val().length>0){
                    sendComment(objId,$('#txtReply').val());}
                else {alert("Enter some thing to comment..")}
            });
        }

        //Hard page id
        var pageID = 177872845972148;

        //Get post every 5s
        getAllPosts();
        setInterval(function () { getAllPosts(); },5000);



        //Get all posts
        function getAllPosts() {
            $.ajax({
                url: '/allPostsByBrand',
                type: "GET",
                dataType: "json",
                success: function (data) {


                    $('#post-box').empty();
                    $.each(data,function (index) {

                        $('#post-box').append(

                                '<div class="item" onclick="getCommentById('+data[index].id+')">'
                                +'<img onload="http://localhost:8080/img/user_img.jpg" src="http://graph.facebook.com/'+data[index].createdBy+'/picture" alt="user image">'
                                +'<p class="message">'
                                +'<a class="name">'
                                +'<small class="text-muted pull-right">'
                                +jQuery.format.prettyDate( new Date(data[index].createdAt))
                                +'</small>'
                                +data[index].createdByName
                                +' </a>'
                                +'</p>'
                                +'<p style="margin-top: 30px;height: 35px;overflow: hidden">'+data[index].content+'</p>'
                                +'<div style="color: gray; bottom: 0px;text-align: center; ">'
                                +'<div class="inline"  style="margin-right: 10px"><span class="glyphicon glyphicon-thumbs-up"></span>&nbsp;'+data[index].likesCount+'</div>'
                                +'<div class="inline"style="margin-right: 10px"><span class="glyphicon glyphicon-comment"></span>&nbsp;'+data[index].commentsCount+' </div>'
                                +'<div class="inline" style="margin-right: 10px"> <span class="glyphicon glyphicon-share-alt"></span>&nbsp;'+data[index].sharesCount+'</div>'
                                +'</div>'
                                +'</div>'


                        )
                    });
                }
            });

        }


        //Get comments for posts
        function getCommentById(postId) {
            $('#comment-box').empty();
            $('#comment-box').html('Loading....');
            getPostById(postId);
            $.ajax({
                url: '/commentbypostWithSen',
                type: "GET",
                data: { postId: postId },
                dataType: "json",
                success: function (data){
                    $('#comment-box').empty();
                    $.each(data,function (index)
                    {

                        var cmtId= "'"+postId+"_"+data[index].id+"'";
                        $('#comment-box').append(
                                    '<div  class="cmt" onclick="replyToComment('+cmtId+')">'
                                +'<div class="col-lg-10 cmtContent">' +
                                '<img onload="http://localhost:8080/img/user_img.jpg" src="http://graph.facebook.com/'+data[index].createdBy+'/picture" alt="user image">'
                                +'<p class="message">'
                                +'<a>'
                                +data[index].createdByName
                                +'<small class="text-muted" style="margin-left: 10px">'
                                +jQuery.format.prettyDate( new Date(data[index].createdAt))
                                +'</small>'
                                +' </a>'
//                                +'<small class="fa fa-smile-o">'+data[index].sentimentScore+'</small>'

                                +'<p style="margin-left: 65px;margin-top: -10px ">'+data[index].content+'</p>'
                                //+'</p> <div class="btn btn-sm btn-primary pull-right" onclick="$(this).parent().append((createReply()))">Reply</div></div>')
                                +'</p>'
                                +'</div>'
                                +'<div class="col-lg-2" style="margin-top: 30px">' +'<small class="fa fa-smile-o pull-right" style="font-size: 20px; color: #50D050"></small>'
                                +'</div>'
                                +'</div>')
                    });
                }
            })
        }


        //Get post by id
        function getPostById(postId) {
            $.ajax({
                url: '/postById',
                type: "GET",
                data: { postId: postId },
                dataType: "json",
                success: function (data){

//                    $('#post-detail').html(
//                            '<div class="item"> <img src="http://localhost:8080/img/user_img.jpg" alt="user image"> <p class="message">'
//                            +'<a class="name">'
//                            +'<small class="text-muted pull-right">'
//                            +jQuery.format.date( new Date(data.createdAt),'dd/MM/yyyy')+' at '+jQuery.format.date( new Date(data.createdAt),'HH:mm')
//                            +'</small>'+
//                            'Author Name'
//                            +'</a>' +
//                            data.content+'</p></div>'
//                    );

                    $('#post-content').html(data.content);
                    $('#post-author').html(data.createdByName);
                    $('#post-like-count').html('<span class="glyphicon glyphicon-thumbs-up"></span>&nbsp;'+data.likesCount+'&nbsp;Likes');
                    $('#post-comment-count').html('<span class="glyphicon glyphicon-comment"></span>&nbsp;'+data.commentsCount+'&nbsp;Comments');
                    $('#post-share-count').html('<span class="glyphicon glyphicon-share-alt"></span>&nbsp;'+data.sharesCount+'&nbsp;Shares');
                    $('#post-image').attr('src','http://graph.facebook.com/'+data.createdBy+'/picture')
                    //Set onClick command for comment button
                    $('#btnSendComment').unbind().click( function ()
                    {
                        var objId=(pageID+"_"+postId);
                        if ($('#txtComment').val().length>0){
                            sendComment(objId,$('#txtComment').val());}
                        else {alert("Enter some thing to comment..")}
                    });
                }
            })
        }
        //Send comment button
        function sendComment(objId, message) {
            $.ajax({
                url: '/commentOnObj',
                type: "POST",
                data: { objId: objId,message:message },
                dataType: "json",
                success: function (data)
                {

                    $('#txtComment').val('');
                    $('#txtReply').val('');
                    $('#myModal').modal('hide');
                }
            });}
    </script>
    <link rel="stylesheet" th:href="@{/css/scc-post.css}"/>
</head>
<body class="hold-transition skin-blue sidebar-mini">


<div class="wrapper">
    <div class="content-wrapper"  style="max-height: 90vh;overflow: hidden">

            <div class="modal fade" id="myModal" role="dialog">
                <div class="modal-dialog">
                    <!-- Modal content-->
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">Reply to comment</h4>
                        </div>
                        <div class="modal-body">
                            <textarea  placeholder="Write a reply...." type="text" class="form-control" rows="3"  id="txtReply"></textarea>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-primary " id="btnReply">Reply</button>
                        </div>
                    </div>

                </div>
            </div>

            <section class="col-lg-3 postlist">

                <div >

                    <div class="box-body chat" id="post-box">
                        <!--Post list here-->
                    </div>

                </div>
            </section>

            <section class="col-lg-6 cmtbox"  style="background-color: gray  ; border-left: 1px solid lightgray">
                <div>
                    <div class="box-body chat">
                        <div  id="postx-detail" class="postdetail">
                            <img src="http://localhost:8080/img/user_img.jpg" alt="user image" id="post-image">
                            <p class="author" id="post-author">Kitty Bang Bang</p>
                            <p style="margin-top: 40px; overflow: hidden" id="post-content">
                                shortSomething   shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething shortSomething
                            </p>

                            <div style="color: gray">
                                <div class="inline" style="margin-right: 15px" id="post-like-count"><span class="glyphicon glyphicon-thumbs-up"></span>30 likes</div>
                                <div class="inline" style="margin-right: 15px" id="post-comment-count"><span class="glyphicon glyphicon-comment"></span>100 comments</div>
                                <div class="inline" style="margin-right: 15px" id="post-share-count"><span class="glyphicon glyphicon-share-alt"></span>10 shares</div>
                            </div>
                        </div>
                        <div id="comment-box" class="cmtList" style="">
                            <!-- This is posts list -->
                        </div>
                    </div>
                </div>
            </section>
        <section class="col-lg-2"style="padding: 0; margin:0px 0px 0px 0px; border-left: 1px solid lightgray;height: 100vh">
            <div>
            <ul class="nav nav-tabs" style="overflow: hidden;width: 100vh;display: inline-block; margin-top: 10px">
                <li class="active"><a data-toggle="tab" href="#home">Ticket Detail</a></li>
                <li><a data-toggle="tab" href="#menu1">History</a></li>
                <li><a data-toggle="tab" href="#menu1">Reply</a></li>
            </ul>
            <div class="tab-content" style="height: 100vh;background-color: white; width: 100vh; margin-top: -5px">
                <div class="tab-pane active" id="tab_1" style="max-height: 100%">


                </div>

                <div class="tab-pane" id="tab_2" style="max-height: 100%">
                </div>

                <div class="tab-pane" id="tab_3" style="max-height: 100%">

                </div>

            </div>
            </div>

        </section>

    </div>

</div>
</body>
</html>
