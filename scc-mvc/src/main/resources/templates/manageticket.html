<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <title>Social Customer Care</title>
    <header class="main-header" th:include="head::header"></header>
    <aside class="main-sidebar" th:include="sidebar::aside"></aside>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.12/css/jquery.dataTables.min.css"/>

    <script src="//cdn.datatables.net/1.10.12/js/jquery.dataTables.min.js"></script>
    <script src="js/moment.min.js"></script>
    <script th:src="@{/js/jquery_dateFormat.js}"></script>
    <script>

        $(document).ready(function () {
            table= $("#table").dataTable({
                ajax: {
                    url:"/getallticket",
                    type: "GET"
                },
                sAjaxDataProp : "",
                columns: [
                    {title: "ID", data:"id",visible:false},
                    {title: "Name",data:"name" },
                    {title: "Created By",data:"createbyuser"},
                    {title: "Assignee",data:"assigneeuser"},
                    {title: "Status",data:"currentstatus"},
                    {title: "Created Time",data:"createdtime"},
                    {title: "Priority", data:"currentpriority"},
                    {title: "Note", data:"note"},
                    {title:"Action",data:"name"},
                ],

                columnDefs:[
                    {
                        width:'20%',
                        targets: 7,
                        render: (data, type, row) => {
                        return '<h5 style="overflow: hidden; max-height: 100px;word-wrap: break-word">'+row.note+'</h5>'
                    },
            },
                    {
                        width:'20%',
                        targets: 1,
                        render: (data, type, row) => {
                        return '<h5 style="overflow: hidden; max-height: 100px"><a href="followticket?ticketid='+row.id+'">'+row.name+'</a></h5>'
                    },
        },
            {
                width:'15%',
                        targets: 5,
                    render: (data, type, row) => {
                if(type=== 'display'){
                    return moment(row.createdtime).format("D/MM/YYYY h:mm:ss");
                }
                return moment(data).format("D/MM/YYYY");
            },
            },
            {
                width:'20%',
                        targets: 8,
                    render: (data, type, row) => {
                if(type==='display'){
                    if(staff){
                        return '<div class="btn-group btn-xs">'
                                +'<button class="btn btn-success btn-xs" onclick="forwardticket('+row.id+')"><i class="fa fa-ticket"></i></button>'
                                +'<button class="btn btn-primary btn-xs" onclick="status('+row.id+')"><i class="fa fa-navicon"></i></button>'
                                +'<button class="btn btn-danger btn-xs" onclick="updateticket('+row.id+')"><i class="fa fa-pencil"></i></button>'
                                +'</div>'
                    }else{
                        return '<div class="btn-group btn-xs">'
                                +'<button class="btn btn-success btn-xs" onclick="assign('+row.id+')"><i class="fa fa-ticket"></i></button>'
                                +'<button class="btn btn-primary btn-xs" onclick="status('+row.id+')"><i class="fa fa-navicon"></i></button>'
                                +'<button class="btn btn-danger btn-xs" onclick="updateticket('+row.id+')"><i class="fa fa-pencil"></i></button>'
                                +'</div>'
                    }

                }
                return data;
            },
            },
            {
                width:'10%',
                        targets: 4,
                    render: (data, type, row) => {
                if(type=== 'display'){
                    var statuscolor;
                    switch (row.statusid){
                        case 1: statuscolor='color:#ffff00'; break;
                        case 2: statuscolor='color:#00a65a'; break;
                        case 3: statuscolor='color:#500a6f'; break;
                        case 4: statuscolor='color:#01ff70'; break;
                    }
                    return '<p><i class="fa fa-circle" aria-hidden="true" style="'+statuscolor+'"></i>'+'  ' +row.currentstatus+'</p>'
                }
                return data;
            },
            },
            ],
            initComplete:  function() {
                this.api().columns().every( function (i) {
                    if(i < 7 && i != 1 ){
                        var column = this;
                        var select = $('<select><option value=""></option></select>')
                                .appendTo( $(column.footer()).empty() )
                                .on( 'change', function () {
                                    var val = $.fn.dataTable.util.escapeRegex(
                                            $(this).val()
                                    );

                                    column
                                            .search( val ? '^'+val+'$' : '', true, false )
                                            .draw();
                                } );
                        var array = [];
                        column.data().unique().sort().each( function ( d, j ) {
                            if(typeof d ==='number'){
                                if(jQuery.inArray(moment(d).format("D/MM/YYYY"), array) < 0) {
                                    select.append( '<option value="'+moment(d).format("D/MM/YYYY")+'">'+moment(d).format("D/MM/YYYY")+'</option>' );
                                }
                                array.push(moment(d).format("D/MM/YYYY"));
                            }else{
                                select.append( '<option value="'+d+'">'+d+'</option>' )
                            }

                        } );
                    }
                } );
            }
        });
        });


    </script>
    <script src="js/manageticket.js"></script>
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">


    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                Ticket management
            </h1>
            <span id="topbtn" class="pull-right">

                  <button class="btn btn-info btn-md " type="button" onclick="configpriority()">
                   <i class="fa fa-cogs" aria-hidden="true"></i> <strong>Config Priority</strong>
                  </button>


       </span>
        </section>

        <!-- Main content -->
        <section class="content">

            <div class="modal fade" id="ticketrequestModal" role="dialog">
                <div class="modal-dialog modal-lg">
                    <!-- Modal content-->
                    <div class="modal-content">
                        <table class="table table-hover">
                            <thead>
                                <th>Ticket</th>
                                <th>Assigner</th>
                                <th>Request at</th>
                                <th>Note</th>
                                <th>Action</th>
                            </thead>
                            <tbody id="request">

                            </tbody>
                        </table>
                    </div>

                </div>
            </div>

            <div class="modal fade" id="assignModal" role="dialog">
                <div class="modal-dialog">
                    <!-- Modal content-->
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">Assign Ticket</h4>
                        </div>
                        <div class="modal-body">
                            <div class="form group">
                                <label for="assignnote">Note</label>
                                <textarea id="assignnote" class="form-control"> </textarea>
                            </div>
                            <div class="form group">
                                <label for="assign">User</label>
                                <select class="form-control" id="assign">
                                </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-primary " id="btnAssign">Assign</button>
                        </div>
                    </div>

                </div>
            </div>

            <div class="modal fade" id="statusModal" role="dialog">
                <div class="modal-dialog">
                    <!-- Modal content-->
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">Change Ticket Status</h4>
                        </div>
                        <div class="modal-body">
                            <div class="form group">
                                <label for="statusnote">Note</label>
                                <textarea id="statusnote" class="form-control"> </textarea>
                            </div>
                            <div class="form group">
                                <label for="status">Status</label>
                                <select class="form-control" id="status">
                                    <option value="3">Open</option>
                                    <option value="4">Inprocess</option>
                                    <option value="5">Solving</option>
                                    <option value="6">Solved</option>
                                </select>
                            </div>

                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-primary " id="btnStatus">Change Status</button>
                        </div>
                    </div>

                </div>
            </div>

            <div class="modal fade" id="changeticketModal" role="dialog">
                <div class="modal-dialog">
                    <!-- Modal content-->
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">Update Ticket</h4>
                        </div>
                        <div class="modal-body">
                            <div class="form group">
                                <label for="ticketnote">Note</label>
                                <textarea class="form-control" id="ticketnote"></textarea>
                            </div>
                            <div class="form group">
                                <label for="ticketpriority"> Priority</label>
                                <select id="ticketpriority" class="form-control" >
                                </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-primary " id="btnChangeTicket">Update Ticket</button>
                        </div>
                    </div>

                </div>
            </div>

            <div class="modal fade" id="configPriorityModal" role="dialog">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">Config Priority</h4>
                        </div>
                        <div class="modal-body" id="brandpriority">


                        </div>
                        <div class="modal-footer">
                            <div class="form-inline" style="text-align: left">
                                <input type="text" placeholder="New Priority" class="form-control" id="newpriorityname" style="width: 20%"/>
                                <input type="number" placeholder="Duration" class="form-control" id="newpriorityduration" style="width: 60%" />
                                <input type="button"  class="btn btn-success btn-xs" value="Create" onclick="createpriority()"/>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="ticketModal" role="dialog">
                <div class="modal-dialog modal-md">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <!--<h4 class="modal-title">Ticket</h4>-->
                            <div id="comment">

                            </div>
                        </div>
                        <div id="reply" class="modal-body">

                        </div>
                        <div class="modal-footer">

                        </div>
                    </div>
                </div>
            </div>

            <div class="modal fade" id="createticketModal" role="dialog">
                <div class="modal-dialog">
                    <!-- Modal content-->
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">Create Ticket</h4>
                        </div>
                        <div class="modal-body">
                            <div class="form group">
                                <label for="newticketname">Name</label>
                                <input type="text" class="form-control" id="newticketname"/>
                            </div>
                            <div class="form group">
                                <label for="newticketpriority"> Priority</label>
                                <select id="newticketpriority" class="form-control" >
                                </select>
                            </div>
                            <div class="form group">
                                <label for="assignee"> Assignee</label>
                                <select id="assignee" class="form-control" >
                                </select>
                            </div>
                            <div class="form group">
                                <label for="newticketnote">Note</label>
                                <textarea class="form-control" id="newticketnote"></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-primary " id="btnCreateTicket">Create Ticket</button>
                        </div>
                    </div>

                </div>
            </div>

            <div class="modal fade" id="createticketstaffModal" role="dialog">
                <div class="modal-dialog">
                    <!-- Modal content-->
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">Create Ticket For you</h4>
                        </div>
                        <div class="modal-body">
                            <div class="form group">
                                <label for="newticketstaffname">Name</label>
                                <input type="text" class="form-control" id="newticketstaffname"/>
                            </div>
                            <div class="form group">
                                <label for="newticketstaffpriority"> Priority</label>
                                <select id="newticketstaffpriority" class="form-control" >
                                </select>
                            </div>
                            <div class="form group">
                                <label for="newticketstaffnote">Note</label>
                                <textarea class="form-control" id="newticketstaffnote"></textarea>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-primary " id="btnCreatestaffTicket">Create Ticket</button>
                        </div>
                    </div>

                </div>
            </div>

            <div class="modal fade" id="forwardModal" role="dialog">
                <div class="modal-dialog">
                    <!-- Modal content-->
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">Forward Ticket</h4>
                        </div>
                        <div class="modal-body">
                            <div class="form group">
                                <label for="forwardnote">Note</label>
                                <textarea class="form-control" id="forwardnote"></textarea>
                            </div>
                            <div class="form group">
                                <label for="forward">Assignee</label>
                                <select class="form-control" id="forward">
                                </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-primary " id="btnForward">Forward</button>
                        </div>
                    </div>

                </div>
            </div>
            <div class="row">
                <section class="col-lg-12">
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="box">

                                <!-- /.box-header -->
                                <div class="box-body table-responsive no-padding">
                                    <table id="table" class="table table-striped table-bordered" style="width:100%">
                                        <thead>

                                        </thead>
                                        <tfoot>
                                        <tr>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                        </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                </section>
                <section class="col-lg-5 connectedSortable">

                </section>
            </div>

        </section>

    </div>

</div>

</body>
</html>
