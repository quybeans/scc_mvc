<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>SCC Admin</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/font-awesome-4.6.3/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="/css/AdminLTE.min.css"/>
    <link rel="stylesheet" href="/css/_all-skins.min.css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="http://momentjs.com/downloads/moment.min.js"></script>
    <script src="/js/jquery-ui.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/app.min.js"></script>
    <script th:src="@{/js/jquery_dateFormat.js}"></script>
    <script>
        getAllSettings();
        getAllUser();
        doOverview();
        getAllBrand();

        function doOverview() {
            $.ajax({
                url: "/admin/overview",
                dataType: "json",
                success: function (data) {
                    $("#page-count").html(data[0]);
                    $("#brand-count").html(data[1]);
                    $("#user-count").html(data[2]);
                },
            });

        }


        function getAllSettings() {
            $.ajax({
                url: "/admin/getSettings",
                dataType: "json",
                success: function (data) {
                    $.each(data, function (index) {
                        if (data[index].name == "crawler_token") $("#crawler_token").attr("value", data[index].value);
                        else if (data[index].name == "crawler_time_limit") {
                            $("#deadTime").attr("value", data[index].value);
                            deadDateCal(parseInt(data[index].value));
                        }
                    })
                },
            });
        }

        function getAllUser() {
            $.ajax({
                url: "/user/getAllUser",
                dataType: "json",
                success: function (data) {
                    $.each(data, function (index) {
                        var active = '<span class="fa fa-circle active"></span>Active</span>';
                        var activeBtn ='<button class="btn btn-pirmary" style="width: 80px">Deactive</button>';
                        if (!data[index].active){ active = '<span class="fa fa-circle inactive"></span>Inactive</span>';
                        activeBtn = '<button class="btn btn-success" style="width: 80px">Active</button>';
                        }

                        $("#user-table").append('<tr>' +
                                '<td>' + data[index].userid + '</td>' +
                                '<td>' + data[index].username + '</td>' +
                                '<td>' + data[index].password + '</td>' +
                                '<td>' + data[index].brandIdName + '</td>' +
                                '<td>' + data[index].createdByName + '</td>' +
                                '<td>' + active + '</td>' +
                                '<td>'+activeBtn+'</td>' +
                                '</tr>');
                    })
                },
            });
        }

        function getAllBrand() {
            $.ajax({
                url: "/admin/getAllBrand",
                dataType: "json",
                success: function (data) {
                    $.each(data, function (index) {
                        $("#brand-body").append(
                                '<div style="height: 90px;" class="brand-item col-lg-6">' +
                                '<img style="margin-top:5px; height: 80px; width: 80px; border: 1px solid lightgray" src="'+data[index].image+'">' +
                                '<div style="font-size: 20px; color: cornflowerblue; font-weight: bold; margin-top: -70px; margin-left: 90px">'+data[index].name+'</div>' +
                                '<div style="font-size: 15px; color: black; margin-left: 90px">'+data[index].sologan+'</div>' +
                                '</div>'
                        );
                    });
                    $("#brand-body").append(
                            '<div style="height: 90px;" class="brand-item col-lg-6">' +
                            '<img src="https://www.insidehighered.com/sites/default/server_files/media/plus.png" style="margin-top:5px; height: 80px; width: 80px; border: 1px solid lightgray">' +
                            '<div style="font-size: 20px; color: black; margin-top: -70px; margin-left: 90px">New brand</div>' +
                            '</div>'
                    );
                },
            });
        }
        getAllPage();
        function getAllPage() {
            $.ajax({
                url: "/admin/getAllPage",
                dataType: "json",
                success: function (data) {
                    $.each(data, function (index) {
                        var postCount=0;
                        var cmtCount=0;
                        $.ajax({
                            url: "/page/overview",
                            data:{pageId:data[index].pageid},
                            dataType: "json",
                            async: false,
                            success: function (count) {postCount=count[0]; cmtCount=count[1]}});

                        $("#page-list").append(
                                '<div class="col-lg-12" style="border-bottom: 1px solid #ebebeb"><div style="height: 70px;" class="brand-item col-lg-6">' +
                                '<img style="margin-top:10px; height: 50px; width: 50px; border: 1px solid lightgray" src="http://graph.facebook.com/'+data[index].pageid+'/picture">' +
                                '<div style="font-size: 15px; color: cornflowerblue; font-weight: bold; margin-top: -50px; margin-left: 60px">'+data[index].name+'</div>' +
                                '<div style="font-size: 13px; color: black; margin-left: 60px">'+data[index].category+'</div>' +
                                '</div>'+
                                '<div style="height: 70px;" class="brand-item col-lg-3">' +
                                '<div style="margin-top: 10px"><span class="fa fa-pencil" style="color: lightgray;margin-right: 10px"></span><span>'+postCount+'</span>&nbsp;posts</div>'+
                                '<div ><span class="fa fa-comment fa-flip-horizontal" style="color: lightgray;margin-right: 10px"></span><span>'+cmtCount+'</span>&nbsp;comments</div>'+
                                '</div>' +
                                '<div style="height: 70px;" class="brand-item col-lg-3">' +
                                '<div style="margin-top: 10px"><span class="fa fa-check active" style="margin-right: 10px"></span><span></span>&nbsp;Crawled</div>'+
                                '<div ><span class="fa fa-circle" style="color:gray;margin-right: 10px"></span><span></span>&nbsp;Webhooks</div>'+
                                '</div>'+
                                '</div>'
                        );
                    });
                },
            });
        }

        function saveSettings() {
            $('#save-icon').attr("class", "fa fa-spin fa-circle-o-notch")
            $.ajax({
                type: "POST",
                url: "/settings/save",
                dataType: "json",
                data: {txtToken: $('#crawler_token').val(), txtDeadTime: $('#deadTime').val()},
                success: function (data) {
                    if (data) {
                        $('#save-icon').attr("class", "fa fa-check")
                    }
                },
            });
        }

        function onEdit() {
            $('#save-icon').attr("class", "fa fa-floppy-o");
        }

        function deadDateCal(month) {
            var threeMonthsAgo = moment().subtract(month, 'months');
            $('#deadDate').html("" + threeMonthsAgo.format('LL'));
        }

    </script>
    <style>
        .brandlist .brand-item:hover
        {
             background-color: lightblue;
            cursor: pointer;
        }
        .active {
            color: #00c200;
            margin-right: 10px;
        }

        .inactive {
            color: gray;
            margin-right: 10px;
        }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            /* display: none; <- Crashes Chrome on hover */
            -webkit-appearance: none;
            margin: 0; /* <-- Apparently some margin are still there even though it's hidden */
        }</style>
</head>
<body class="hold-transition skin-green" style="background-color: whitesmoke">
<header class="main-header">
    <!-- Logo -->
    <a href="#" class="logo">

        <!-- logo for regular state and mobile devices -->
        <span class="logo-lg"><span class="glyphicon glyphicon-cog"
                                    style="margin-right: 10px"></span><b>SCC</b> Admin</span>
    </a>

    <nav class="navbar navbar-static-top">
        <div class="navbar-custom-menu">
            <ul class="nav navbar-nav">
                <li class="dropdown user user-menu">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        <span class="hidden-xs" th:text="${session.fullname}"></span>
                    </a>
                </li>
                <li class="dropdown user user-menu">
                    <a href="/LogOut" class="bg-green-active" style="text-align: center">Sign out</a>
                </li>
            </ul>
        </div>
    </nav>
</header>

<section class="content-header">
</section>
<section class="content">
    <div class="col-md-6">
        <div class="box box-success">
            <div class="box-header with-border" style="font-size: 20px; font-weight: bold"><span
                    class="glyphicon glyphicon-wrench"
                    style="margin-right: 10px"></span>Spider
                configure
            </div>
            <div class="box-body" style="height: 168px">
                <div class="form-horizontal">
                    <div class="form-group">
                        <label class="control-label col-sm-4" style="margin-right: 10px"> Crawling data within:</label>
                        <div class="col-sm-7">
                            <input onfocusout="deadDateCal($('#deadTime').val())" onKeyUp="onEdit()"
                                   class="input-sm form-control"
                                   type="number" value="3"
                                   style="width: 40px;text-align: center; display: inline; margin-right: 10px; font-size: 13px"
                                   id="deadTime">months
                            <div class="inline" style="margin-left: 40px"><label>Dead date:</label> <span id="deadDate"
                                                                                                          style="margin-left: 15px">16/19/2016</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-4" style="margin-right: 10px" for="crawler_token"> Crawler
                            token:</label>
                        <div class=" col-sm-7">
                            <input onKeyUp="onEdit()" class="form-control input-sm" type="text" value="3"
                                   id="crawler_token">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-4" style="margin-right: 10px"> Limit pages crawl
                            at a time: </label>
                        <div class=" col-sm-7">
                            <input class="input-sm form-control" type="text" value="3"
                                   style="width: 40px;text-align: center; display: inline; margin-right: 10px">pages
                        </div>
                    </div>

                </div>
            </div>
            <div class="box-footer with-border" style="font-size: 20px; font-weight: bold;">
                <button class="btn btn-success pull-right" onclick="saveSettings()"><span id="save-icon"
                                                                                          class="fa fa-floppy-o"
                                                                                          style="margin-right: 10px"></span>Save
                </button>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="box box-primary">
            <div class="box-header with-border" style="font-size: 20px; font-weight: bold"><span
                    class="glyphicon glyphicon-globe"
                    style="margin-right: 10px"></span>System
                overview
            </div>
            <div class="box-body">
                <div class="col-lg-4">
                    <div class="small-box bg-blue">
                        <div class="inner">
                            <h3><span id="page-count">6</span><span style="font-size: 20px;margin-left: 10px">pages</span></h3>
                            <p>Facebook</p>
                        </div>
                        <div class="icon">
                            <i class="fa fa-facebook"></i>
                        </div>
                        <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="small-box bg-yellow">
                        <div class="inner">
                            <h3><span id="brand-count">6</span><span style="font-size: 20px;margin-left: 10px">brands</span></h3>
                            <p>Registered</p>
                        </div>
                        <div class="icon">
                            <i class="fa fa-shopping-cart " style="font-size: 80px"></i>
                        </div>
                        <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="small-box bg-teal">
                        <div class="inner">
                            <h3><span id="user-count">6</span><span style="font-size: 20px;margin-left: 10px">users</span></h3>
                            <p>Account</p>
                        </div>
                        <div class="icon">
                            <i class="glyphicon glyphicon-user" style="font-size: 70px"></i>
                        </div>
                        <a href="#" class="small-box-footer">More info <i class="fa fa-arrow-circle-right"></i></a>
                    </div>
                </div>
            </div>
            <div class="box-footer with-border" style="font-size: 20px; font-weight: bold;">
                <button class="btn btn-primary pull-right"><span class="fa fa-plus"
                                                                 style="margin-right: 10px"></span>New brand
                </button>
            </div>
        </div>
    </div>
    <div class="col-md-12">
        <div class="box box-info">
            <div class="box-header with-border" style="font-size: 20px; font-weight: bold">
                <span class="fa fa-users" tyle="margin-right: 10px"></span>Users in the system
            </div>
            <div class="box-body">
                <table class="table table-striped" id="user-table">

                    <tr>
                        <th style="width: 20px">UserID</th>
                        <th>Username</th>
                        <th>Password</th>
                        <th>Brand</th>
                        <th>CreatedBy</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>

                </table>
            </div>
            <div class="box-footer with-border" style="font-size: 20px; font-weight: bold;">

            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="box box-warning">
            <div class="box-header with-border" style="font-size: 20px; font-weight: bold">
                <span class="fa fa-shopping-cart" tyle="margin-right: 10px"></span>Brands registered
            </div>
            <div class="box-body brandlist" id="brand-body">

            </div>
            <div class="box-footer with-border" style="font-size: 20px; font-weight: bold;">

            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="box box-primary">
            <div class="box-header with-border" style="font-size: 20px; font-weight: bold">
                <span class="fa fa-facebook-square" tyle="margin-right: 10px"></span>Facebook pages managing
            </div>
            <div class="box-body" id="page-list">

            </div>
            <div class="box-footer with-border" style="font-size: 20px; font-weight: bold;">

            </div>
        </div>
    </div>
</section>


</body>
</html>